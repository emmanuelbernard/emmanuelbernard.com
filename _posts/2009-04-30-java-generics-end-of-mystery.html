---
title: 'Java generics end of mystery'
author: 'Emmanuel Bernard'
tags: [ java ]
date: 2009-04-30
---
<p>Remember my puzzlement in front of <a href='http://blog.emmanuelbernard.com/2009/04/java-generics-mystery.html'>http://blog.emmanuelbernard.com/2009/04/java-generics-mystery.html</a>?</p><blockquote>  <p>I usually try to make sense of the unknown type by looking at what should be allowed when two incompatible types are used as the unknown type, and then using the generic type using the unknown type as a reference to a known type to see what incorrect things can be done through the reference. If the assignment your questioning was allowed, you would be able to add two incompatible ConstraintValidators to the validatedAddresses as in:<br/><br/> class Address {}<br/> class Person {}<br/><br/> // A set of ConstraintValidator for Address<br/> Set&lt;ConstraintValidator&lt;Address&gt;&gt; validatedAddresses =<br/>     new HashSet&lt;ConstraintValidator&lt;Address&gt;&gt;();<br/><br/> // A set of ConstraintValidator of a single unknown type (*)<br/> Set&lt;ConstraintValidator&lt;?&gt;&gt; validatedThings = validatedAddresses;<br/><br/> ConstraintValidator&lt;Address&gt; a;<br/> ConstraintValidator&lt;Person&gt; p;<br/><br/> // A ConstraintValidator of unknown type, ? = Address<br/> ConstraintValidator&lt;?&gt; thingA = a;<br/><br/> // A ConstraintValidator of unknown type, ? = Person<br/> ConstraintValidator&lt;?&gt; thingP = p;<br/><br/> // This would be allowed if (*) was a valid assignment, which puts a ConstraintValidator&lt;Person&gt; in a set of ConstraintValidator&lt;Address&gt;<br/><br/> validatedThings.add(thingP);</p></blockquote><br/><p>What I missed initially is that I cannot add new (and potentially heterogeneous) elements in Set&lt;?&gt; or Set&lt;? extends X&gt;, but I am free to add elements in Set&lt;X&lt;?&gt;&gt;:</p><blockquote><br/> Set&lt;A&lt;?&gt;&gt; c1 = new HashSet&lt;A&lt;?&gt;&gt;();<br/>c1.add( new A&lt;B&gt;() );<br/>c1.add( new A&lt;C&gt;() );</blockquote><blockquote><br/> Set&lt;? extends A&lt;?&gt;&gt; c1 = new HashSet&lt;A&lt;?&gt;&gt;();<br/>c1.add( new A&lt;B&gt;() ); &lt;-- compilation error<br/>c1.add( new A&lt;C&gt;() ); &lt;-- compilation error<br/></blockquote><br/><p>While the first example compiles, the second does not.</p><p>So to answer my initial mystery, I need to use the &lt;? extends X&lt;?&gt;&gt; approach (thanks Vivien for pointing that out).</p><blockquote>  <p>Set&lt;? extends ConstraintValidator&lt;?&gt;&gt; valiatedThings = ...;</p></blockquote>
